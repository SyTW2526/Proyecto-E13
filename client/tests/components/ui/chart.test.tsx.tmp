import {
  ChartContainer,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
  ChartTooltip,
  ChartTooltipContent,
  useChart,
} from "@/components/ui/chart";
import { render, screen } from "@testing-library/react";
import { Bar, BarChart, Cell, Pie, PieChart } from "recharts";
import { describe, expect, it, vi } from "vitest";

describe("Chart", () => {
  const mockConfig = {
    alta: { label: "Alta", color: "#ef4444" },
    media: { label: "Media", color: "#f59e0b" },
    baja: { label: "Baja", color: "#10b981" },
  };

  const mockData = [
    { name: "Alta", value: 10, fill: "#ef4444" },
    { name: "Media", value: 20, fill: "#f59e0b" },
    { name: "Baja", value: 15, fill: "#10b981" },
  ];

  describe("useChart", () => {
    it("Lanza error cuando se usa fuera de ChartContainer", () => {
      const TestComponent = () => {
        useChart();
        return <div>Test</div>;
      };

      expect(() => render(<TestComponent />)).toThrow(
        "useChart must be used within a <ChartContainer />",
      );
    });

    it("Retorna el config cuando se usa dentro de ChartContainer", () => {
      const TestComponent = () => {
        const { config } = useChart();
        return <div data-testid="config-test">{JSON.stringify(config)}</div>;
      };

      render(
        <ChartContainer config={mockConfig}>
          <TestComponent />
        </ChartContainer>,
      );

      expect(screen.getByTestId("config-test")).toHaveTextContent("alta");
    });
  });

  describe("ChartContainer", () => {
    it("Renderiza el contenedor de gráfico", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      const chartElement = container.querySelector('[data-slot="chart"]');
      expect(chartElement).toBeInTheDocument();
    });

    it("Aplica el ID personalizado al gráfico", () => {
      const { container } = render(
        <ChartContainer config={mockConfig} id="test-chart">
          <PieChart>
            <Pie data={mockData} dataKey="value" />
          </PieChart>
        </ChartContainer>,
      );

      const chartElement = container.querySelector(
        '[data-chart="chart-test-chart"]',
      );
      expect(chartElement).toBeInTheDocument();
    });

    it("Aplica clases personalizadas", () => {
      const { container } = render(
        <ChartContainer config={mockConfig} className="custom-class">
          <BarChart data={mockData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      const chartElement = container.querySelector(".custom-class");
      expect(chartElement).toBeInTheDocument();
    });

    it("Renderiza gráfico de barras completo", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container.firstChild).toBeInTheDocument();
    });

    it("Renderiza gráfico circular con celdas", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <PieChart>
            <Pie data={mockData} dataKey="value">
              {mockData.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={entry.fill} />
              ))}
            </Pie>
          </PieChart>
        </ChartContainer>,
      );

      expect(container.firstChild).toBeInTheDocument();
    });

    it("Renderiza con datos vacíos", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={[]}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container.firstChild).toBeInTheDocument();
    });

    it("Genera ID único cuando no se proporciona", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      const chartElement = container.querySelector('[data-chart^="chart-"]');
      expect(chartElement).toBeInTheDocument();
    });
  });

  describe("ChartStyle", () => {
    it("Genera estilos CSS para la configuración del gráfico", () => {
      const { container } = render(
        <ChartStyle id="test-chart" config={mockConfig} />,
      );

      const styleElement = container.querySelector("style");
      expect(styleElement).toBeInTheDocument();
      expect(styleElement?.innerHTML).toContain("--color-alta");
      expect(styleElement?.innerHTML).toContain("--color-media");
      expect(styleElement?.innerHTML).toContain("--color-baja");
    });

    it("No renderiza nada cuando no hay colores en la configuración", () => {
      const emptyConfig = {
        test: { label: "Test" },
      };

      const { container } = render(
        <ChartStyle id="test-chart" config={emptyConfig} />,
      );

      expect(container.firstChild).toBeNull();
    });

    it("Genera estilos para temas claro y oscuro", () => {
      const themedConfig = {
        primary: {
          label: "Primario",
          theme: {
            light: "#3b82f6",
            dark: "#60a5fa",
          },
        },
      };

      const { container } = render(
        <ChartStyle id="themed-chart" config={themedConfig} />,
      );

      const styleElement = container.querySelector("style");
      expect(styleElement?.innerHTML).toContain("--color-primary");
      expect(styleElement?.innerHTML).toContain("#3b82f6");
      expect(styleElement?.innerHTML).toContain("#60a5fa");
      expect(styleElement?.innerHTML).toContain(".dark");
    });

    it("Maneja configuración con solo color (sin theme)", () => {
      const colorOnlyConfig = {
        success: { label: "Éxito", color: "#10b981" },
      };

      const { container } = render(
        <ChartStyle id="color-chart" config={colorOnlyConfig} />,
      );

      const styleElement = container.querySelector("style");
      expect(styleElement?.innerHTML).toContain("--color-success");
      expect(styleElement?.innerHTML).toContain("#10b981");
    });

    it("Filtra entradas sin color ni theme", () => {
      const mixedConfig = {
        withColor: { label: "Con Color", color: "#ef4444" },
        withoutColor: { label: "Sin Color" },
      };

      const { container } = render(
        <ChartStyle id="mixed-chart" config={mixedConfig} />,
      );

      const styleElement = container.querySelector("style");
      expect(styleElement?.innerHTML).toContain("--color-withColor");
      expect(styleElement?.innerHTML).not.toContain("--color-withoutColor");
    });

    it("Genera múltiples variables CSS para múltiples colores", () => {
      const multiConfig = {
        red: { label: "Rojo", color: "#ef4444" },
        blue: { label: "Azul", color: "#3b82f6" },
        green: { label: "Verde", color: "#10b981" },
      };

      const { container } = render(
        <ChartStyle id="multi-chart" config={multiConfig} />,
      );

      const styleElement = container.querySelector("style");
      expect(styleElement?.innerHTML).toContain("--color-red");
      expect(styleElement?.innerHTML).toContain("--color-blue");
      expect(styleElement?.innerHTML).toContain("--color-green");
    });

    it("Maneja theme con múltiples colores", () => {
      const multiThemedConfig = {
        primary: {
          label: "Primary",
          theme: { light: "#3b82f6", dark: "#60a5fa" },
        },
        secondary: {
          label: "Secondary",
          theme: { light: "#10b981", dark: "#34d399" },
        },
      };

      const { container } = render(
        <ChartStyle id="multi-themed" config={multiThemedConfig} />,
      );

      const styleElement = container.querySelector("style");
      expect(styleElement?.innerHTML).toContain("--color-primary");
      expect(styleElement?.innerHTML).toContain("--color-secondary");
      expect(styleElement?.innerHTML).toContain("#3b82f6");
      expect(styleElement?.innerHTML).toContain("#10b981");
    });
  });

  describe("ChartTooltip y ChartLegend - Integración", () => {
    it("Renderiza tooltip en gráfico de barras", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza leyenda en gráfico de barras", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartLegend />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza tooltip con contenido personalizado", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip content={<ChartTooltipContent />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza leyenda con contenido personalizado", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartLegend content={<ChartLegendContent />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza múltiples barras con tooltip y leyenda", () => {
      const multiData = [
        { name: "A", value1: 10, value2: 20 },
        { name: "B", value1: 15, value2: 25 },
      ];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={multiData}>
            <Bar dataKey="value1" fill="#ef4444" />
            <Bar dataKey="value2" fill="#10b981" />
            <ChartTooltip />
            <ChartLegend />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });
  });

  describe("Integración de componentes", () => {
    it("Renderiza gráfico completo con tooltip y leyenda", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip />
            <ChartLegend />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza múltiples gráficos de barras con configuración", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" fill="#ef4444" />
            <ChartTooltip />
            <ChartLegend />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza gráfico circular con configuración completa", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <PieChart>
            <Pie data={mockData} dataKey="value">
              {mockData.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={entry.fill} />
              ))}
            </Pie>
            <ChartTooltip />
            <ChartLegend />
          </PieChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza con config que tiene iconos", () => {
      const IconComponent = () => <svg data-testid="test-icon" />;
      const configWithIcon = {
        test: { label: "Test", icon: IconComponent, color: "#000" },
      };

      const { container } = render(
        <ChartContainer config={configWithIcon}>
          <BarChart data={[{ name: "Test", value: 10 }]}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Maneja datos con valores null", () => {
      const nullData = [
        { name: "A", value: 10 },
        { name: "B", value: null },
        { name: "C", value: 15 },
      ];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={nullData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza con diferentes tipos de indicadores", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip content={<ChartTooltipContent indicator="line" />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });
  });

  // Edge Cases / Casos Borde
  describe("Edge Cases", () => {
    it("Maneja config vacío", () => {
      const { container } = render(
        <ChartContainer config={{}}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container.firstChild).toBeInTheDocument();
    });

    it("Maneja datos completamente vacíos", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={[]}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container.firstChild).toBeInTheDocument();
    });

    it("Maneja colores inválidos en config", () => {
      const invalidConfig = {
        test: { label: "Test", color: "invalid-color" },
      };

      const { container } = render(
        <ChartContainer config={invalidConfig}>
          <BarChart data={[{ name: "Test", value: 10 }]}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza con className undefined", () => {
      const { container } = render(
        <ChartContainer config={mockConfig} className={undefined}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container.firstChild).toBeInTheDocument();
    });

    it("Maneja ID duplicado correctamente", () => {
      const { container } = render(
        <>
          <ChartContainer config={mockConfig} id="same-id">
            <BarChart data={mockData}>
              <Bar dataKey="value" />
            </BarChart>
          </ChartContainer>
          <ChartContainer config={mockConfig} id="same-id">
            <PieChart>
              <Pie data={mockData} dataKey="value" />
            </PieChart>
          </ChartContainer>
        </>,
      );

      const charts = container.querySelectorAll('[data-chart="chart-same-id"]');
      expect(charts.length).toBeGreaterThan(0);
    });

    it("Renderiza con datos que contienen valores negativos", () => {
      const negativeData = [
        { name: "A", value: -10 },
        { name: "B", value: 20 },
        { name: "C", value: -5 },
      ];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={negativeData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Maneja datos con valores cero", () => {
      const zeroData = [
        { name: "A", value: 0 },
        { name: "B", value: 0 },
        { name: "C", value: 0 },
      ];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={zeroData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza sin ChartTooltip ni ChartLegend", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Maneja config con propiedades undefined", () => {
      const partialConfig = {
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        test: { label: undefined as any, color: undefined as any },
      };

      const { container } = render(
        <ChartContainer config={partialConfig}>
          <BarChart data={[{ name: "Test", value: 10 }]}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza ChartTooltipContent con hideLabel", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip content={<ChartTooltipContent hideLabel />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza ChartTooltipContent con hideIndicator", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip content={<ChartTooltipContent hideIndicator />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Maneja datos con propiedades extra", () => {
      const extraData = [
        { name: "A", value: 10, extra: "data", another: 123 },
        { name: "B", value: 20, extra: "more", another: 456 },
      ];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={extraData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza con array de indicadores", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip content={<ChartTooltipContent indicator="dashed" />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Maneja ChartStyle sin children", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <>
            <ChartStyle id="test" config={mockConfig} />
            <BarChart data={mockData}>
              <Bar dataKey="value" />
            </BarChart>
          </>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza con datos que contienen strings en value", () => {
      const stringData = [
        { name: "A", value: "10" },
        { name: "B", value: "20" },
      ];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          {/* eslint-disable-next-line @typescript-eslint/no-explicit-any */}
          <BarChart data={stringData as any}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Maneja múltiples ChartLegend en el mismo gráfico", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartLegend />
            <ChartLegend />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza con config que tiene muchas propiedades", () => {
      const largeConfig = {
        item1: { label: "Item 1", color: "#111" },
        item2: { label: "Item 2", color: "#222" },
        item3: { label: "Item 3", color: "#333" },
        item4: { label: "Item 4", color: "#444" },
        item5: { label: "Item 5", color: "#555" },
      };

      const { container } = render(
        <ChartContainer config={largeConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Maneja datos con un solo elemento", () => {
      const singleData = [{ name: "Solo", value: 100 }];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={singleData}>
            <Bar dataKey="value" />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });
  });

  // Tests adicionales para ChartTooltipContent y ChartLegendContent
  describe("ChartTooltipContent - Cobertura adicional", () => {
    it("Renderiza tooltip con labelFormatter personalizado", () => {
      const labelFormatter = (label: string) => `Custom: ${label}`;
      
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip 
              content={<ChartTooltipContent labelFormatter={labelFormatter} />} 
            />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza tooltip con indicator dot", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip 
              content={<ChartTooltipContent indicator="dot" />} 
            />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza tooltip con nameKey personalizado", () => {
      const customData = [
        { category: "Alta", value: 10 },
        { category: "Media", value: 20 },
      ];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={customData}>
            <Bar dataKey="value" />
            <ChartTooltip 
              content={<ChartTooltipContent nameKey="category" />} 
            />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza tooltip con labelKey personalizado", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip 
              content={<ChartTooltipContent labelKey="name" />} 
            />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza tooltip con formatter personalizado", () => {
      const formatter = (value: number, name: string) => [`${value}%`, name];
      
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip 
              // eslint-disable-next-line @typescript-eslint/no-explicit-any
              content={<ChartTooltipContent formatter={formatter as any} />} 
            />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza tooltip con config que tiene iconos", () => {
      const IconComponent = () => <svg data-testid="custom-icon" />;
      const configWithIcon = {
        alta: { label: "Alta", color: "#ef4444", icon: IconComponent },
      };

      const { container } = render(
        <ChartContainer config={configWithIcon}>
          <BarChart data={[{ name: "alta", value: 10 }]}>
            <Bar dataKey="value" />
            <ChartTooltip content={<ChartTooltipContent />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza tooltip con color personalizado", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip 
              content={<ChartTooltipContent color="#ff0000" />} 
            />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza tooltip con labelClassName", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartTooltip 
              content={<ChartTooltipContent labelClassName="custom-label" />} 
            />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });
  });

  describe("ChartLegendContent - Cobertura adicional", () => {
    it("Renderiza leyenda con verticalAlign top", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartLegend content={<ChartLegendContent verticalAlign="top" />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza leyenda con hideIcon", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={mockData}>
            <Bar dataKey="value" />
            <ChartLegend content={<ChartLegendContent hideIcon />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza leyenda con nameKey personalizado", () => {
      const customData = [
        { category: "Alta", value: 10 },
        { category: "Media", value: 20 },
      ];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          <BarChart data={customData}>
            <Bar dataKey="value" />
            <ChartLegend content={<ChartLegendContent nameKey="category" />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza leyenda con config que tiene iconos", () => {
      const IconComponent = () => <svg data-testid="legend-icon" />;
      const configWithIcon = {
        alta: { label: "Alta", color: "#ef4444", icon: IconComponent },
        media: { label: "Media", color: "#f59e0b", icon: IconComponent },
      };

      const { container } = render(
        <ChartContainer config={configWithIcon}>
          <BarChart data={[{ name: "alta", value: 10 }, { name: "media", value: 20 }]}>
            <Bar dataKey="value" />
            <ChartLegend content={<ChartLegendContent />} />
          </BarChart>
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });

    it("Renderiza leyenda sin payload", () => {
      const { container } = render(
        <ChartContainer config={mockConfig}>
          <ChartLegendContent payload={[]} />
        </ChartContainer>,
      );

      expect(container.querySelector('[data-slot="chart"]')).toBeInTheDocument();
    });

    it("Filtra elementos con type none de la leyenda", () => {
      const payloadWithNone = [
        { value: "alta", type: "line", color: "#ef4444", dataKey: "alta" },
        { value: "none", type: "none", color: "#000", dataKey: "none" },
        { value: "media", type: "line", color: "#f59e0b", dataKey: "media" },
      ];

      const { container } = render(
        <ChartContainer config={mockConfig}>
          {/* eslint-disable-next-line @typescript-eslint/no-explicit-any */}
          <ChartLegendContent payload={payloadWithNone as any} />
        </ChartContainer>,
      );

      expect(container).toBeInTheDocument();
    });
  });

